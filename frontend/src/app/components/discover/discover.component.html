<div class="container mt-4">
    <!-- DISCOVER -->
    @if (tourDiscovers().length > 0) {
    <div class="mb-3">

        <!-- Títol desplegable -->
        <h3 class="d-flex align-items-center justify-content-between" (click)="toggleSection('discover')" role="button">
            <span><i class="bi bi-search me-2"></i>Discover the Area</span>
            <i class="bi" [ngClass]="{
          'bi-chevron-down': expandedSection !== 'discover',
          'bi-chevron-up': expandedSection === 'discover'
        }"></i>
        </h3>
        <img [src]="'http://localhost:3001' + tourDiscovers()[0]?.imatge_url"
            class="img-fluid mt-2 mb-3 w-100 rounded-1" alt="Discover Preview" />

        <!-- Desplegable -->
        <div class="accordion-content" [ngClass]="{ 'expanded': expandedSection === 'discover' }">
            @for (discover of tourDiscovers(); track discover.id_discover) {
            <h5 class="mt-3">{{ discover.titol }}</h5>

            <div [ngClass]="{
            'readmore-wrapper': true,
            'expanded': isExpanded(discover.id_discover)
          }">
                <p class="mb-0" [ngClass]="{ 'clamp-text': !isExpanded(discover.id_discover) }">
                    {{ discover.descripcio }}
                </p>
            </div>

            <button class="btn btn-red rounded-1 p-1 mt-2" (click)="toggleDiscover(discover.id_discover)">
                @if (isExpanded(discover.id_discover)) {
                Show less <i class="bi bi-arrow-up"></i>
                } @else {
                Read more <i class="bi bi-arrow-down"></i>
                }
            </button>

            <div class="section-divider"></div>
            }
        </div>
    </div>
    }


    <!-- LOCATIONS -->

    @if (tourLocations().length > 0) {
    <div class="mb-3">
        <!-- Títol clicable -->
        <!-- Títol clicable -->
        <h3 class="d-flex align-items-center justify-content-between" (click)="toggleSection('locations')"
            role="button">
            <span><i class="bi bi-geo-alt-fill me-2"></i>Points of Interest</span>
            <i class="bi" [ngClass]="{
      'bi-chevron-down': expandedSection !== 'locations',
      'bi-chevron-up': expandedSection === 'locations'
    }"></i>
        </h3>

        <!-- Imatge destacada SEMPRE visible (només la del primer location) -->
        <img [src]="'http://localhost:3001' + tourLocations()[0]?.imatge_url"
            class="img-fluid mt-2 mb-3 w-100 rounded-1" [alt]="tourLocations()[0]?.nom_location" />

        <!-- Contingut desplegable -->
        <div class="accordion-content" [ngClass]="{ 'expanded': expandedSection === 'locations' }">
            @for (location of tourLocations(); track location.id_location) {

            <!-- ✅ NOMÉS mostra la imatge si NO és el primer -->
            @if (location.id_location !== tourLocations()[0]?.id_location) {
            <img [src]="'http://localhost:3001' + location.imatge_url" class="img-fluid mt-2 mb-2 w-100 rounded-1"
                [alt]="location.nom_location" />
            }

            <h5 class="mt-3">{{ location.nom_location }}</h5>

            <div [ngClass]="{
        'readmore-wrapper': true,
        'expanded': isExpanded(location.id_location)
      }">
                <p class="mb-0" [ngClass]="{ 'clamp-text': !isExpanded(location.id_location) }">
                    {{ location.descripcio }}
                </p>
            </div>

            <button class="btn btn-red rounded-1 p-1 mt-2" (click)="toggleDiscover(location.id_location)">
                @if (isExpanded(location.id_location)) {
                Show less <i class="bi bi-arrow-up"></i>
                } @else {
                Read more <i class="bi bi-arrow-down"></i>
                }
            </button>

            <div class="section-divider"></div>
            }
        </div>

    </div>
    }



    <!-- HOTELS -->
    @if (tourHotels().length > 0) {
    <div class="mb-3">
        <!-- Títol clicable -->
        <h3 class="d-flex align-items-center justify-content-between" (click)="toggleSection('hotels')" role="button">
            <span><i class="bi bi-house-fill me-2"></i>Accommodation</span>
            <i class="bi" [ngClass]="{
          'bi-chevron-down': expandedSection !== 'hotels',
          'bi-chevron-up': expandedSection === 'hotels'
        }"></i>
        </h3>

        <!-- Imatge SEMPRE visible -->
        <img [src]="'http://localhost:3001' + tourHotels()[0]?.imatge_url" class="img-fluid mt-2 mb-3 w-100 rounded-1"
            [alt]="tourHotels()[0]?.nom_hotel" />

        <!-- Contingut desplegable -->
        <div class="accordion-content" [ngClass]="{ 'expanded': expandedSection === 'hotels' }">
            @for (hotel of tourHotels(); track hotel.id_hotel) {
            <h5 class="mt-3">
                {{ hotel.nom_hotel }}
                @if (hotel.nits) {
                - {{ hotel.nits }} nights
                }
            </h5>

            <div [ngClass]="{
            'readmore-wrapper': true,
            'expanded': isExpanded(hotel.id_hotel)
          }">
                <p class="mb-0" [ngClass]="{ 'clamp-text': !isExpanded(hotel.id_hotel) }">
                    {{ hotel.descripcio }}
                </p>
            </div>

            @if (hotel.enllac) {
            <a [href]="hotel.enllac" target="_blank" rel="noopener noreferrer">
                Visit Hotel Website
            </a>
            }

            <button class="btn btn-red rounded-1 p-1 mt-3" (click)="toggleDiscover(hotel.id_hotel)">
                @if (isExpanded(hotel.id_hotel)) {
                Show less <i class="bi bi-arrow-up"></i>
                } @else {
                Read more <i class="bi bi-arrow-down"></i>
                }
            </button>

            <div class="section-divider"></div>
            }
        </div>
    </div>
    }


</div>